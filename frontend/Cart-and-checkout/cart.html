<!doctype html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giỏ Hàng - Cửa Hàng Sách</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100%;
      padding: 40px 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .page-header {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-header h1 {
      color: #2d3748;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .page-header h1 i {
      color: #667eea;
    }

    .page-nav {
      display: flex;
      gap: 15px;
    }

    .nav-btn {
      padding: 10px 20px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      font-weight: 600;
    }

    .nav-btn.active {
      background: #667eea;
      color: white;
    }

    .nav-btn:hover {
      background: #667eea;
      color: white;
    }

    .page-content {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 30px;
    }

    .items-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .select-all-section {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 25px;
      border: 2px solid #e2e8f0;
    }

    .select-all-checkbox {
      width: 20px;
      height: 20px;
      accent-color: #667eea;
      cursor: pointer;
    }

    .select-all-label {
      font-weight: 600;
      color: #2d3748;
      cursor: pointer;
      user-select: none;
    }

    .item {
      display: flex;
      gap: 20px;
      padding: 25px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      background: #fafafa;
      position: relative;
    }

    .item.selected {
      border-color: #667eea;
      background: #f0f4ff;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .item:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .item-checkbox {
      width: 20px;
      height: 20px;
      accent-color: #667eea;
      cursor: pointer;
      margin-top: 5px;
    }

    .book-image {
      width: 100px;
      height: 130px;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      flex-shrink: 0;
    }

    .item-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .book-info {
      margin-bottom: 15px;
    }

    .book-title {
      font-size: 18px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .book-author {
      color: #718096;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .book-price {
      font-size: 16px;
      font-weight: 600;
      color: #667eea;
    }

    .item-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 15px;
    }

    .quantity-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .quantity-label {
      color: #4a5568;
      font-size: 14px;
      font-weight: 500;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      gap: 12px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 5px;
    }

    .quantity-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #667eea;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 18px;
    }

    .quantity-btn:hover {
      background: #5568d3;
      transform: scale(1.1);
    }

    .quantity-btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }

    .quantity-display {
      min-width: 40px;
      text-align: center;
      font-weight: 600;
      color: #2d3748;
    }

    .item-total {
      font-size: 18px;
      font-weight: 700;
      color: #667eea;
    }

    .remove-btn {
      background: none;
      border: none;
      color: #e53e3e;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .remove-btn:hover {
      background: #fff5f5;
      transform: scale(1.1);
    }

    .summary-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .summary-title {
      font-size: 22px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e2e8f0;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      color: #4a5568;
      font-size: 15px;
    }

    .summary-row.total {
      font-size: 20px;
      font-weight: 700;
      color: #2d3748;
      padding-top: 20px;
      border-top: 2px solid #e2e8f0;
      margin-top: 20px;
    }

    .summary-row.total .amount {
      color: #667eea;
    }

    .selected-count {
      background: #667eea;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }

    .checkout-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .checkout-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .checkout-btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .continue-shopping {
      width: 100%;
      padding: 14px;
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s ease;
    }

    .continue-shopping:hover {
      background: #667eea;
      color: white;
    }

    /* Checkout Page Styles */
    .checkout-form {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      color: #2d3748;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e2e8f0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #2d3748;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .discount-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
    }

    .discount-input-group {
      display: flex;
      gap: 10px;
    }

    .discount-input {
      flex: 1;
    }

    .apply-btn {
      padding: 12px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .apply-btn:hover {
      background: #5568d3;
    }

    .checkout-items {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .checkout-item {
      display: flex;
      gap: 20px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      margin-bottom: 15px;
      background: #fafafa;
    }

    .checkout-item-image {
      width: 80px;
      height: 100px;
      border-radius: 6px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .checkout-item-details {
      flex: 1;
    }

    .checkout-item-title {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 5px;
    }

    .checkout-item-author {
      color: #718096;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .checkout-item-quantity {
      color: #4a5568;
      font-size: 14px;
    }

    .checkout-item-price {
      font-weight: 700;
      color: #667eea;
      font-size: 16px;
      text-align: right;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }

    .empty-state i {
      font-size: 80px;
      color: #cbd5e0;
      margin-bottom: 20px;
    }

    .empty-state h3 {
      color: #2d3748;
      margin-bottom: 10px;
    }

    @media (max-width: 992px) {
      .page-content {
        grid-template-columns: 1fr;
      }

      .summary-section {
        position: static;
      }

      .page-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
    }

    @media (max-width: 576px) {
      .item {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .book-image {
        width: 100%;
        max-width: 200px;
        height: 250px;
      }

      .item-actions {
        flex-direction: column;
        gap: 15px;
        width: 100%;
      }

      .quantity-control {
        width: 100%;
        justify-content: center;
      }

      .discount-input-group {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="page-header">
      <h1 id="pageTitle"><i class="bi bi-cart-fill"></i> Giỏ Hàng Của Bạn</h1>
      <div class="page-nav"><button class="nav-btn active" id="cartBtn" onclick="showCart()"> <i class="bi bi-cart"></i>
          Giỏ Hàng </button> <button class="nav-btn" id="checkoutBtn" onclick="showCheckout()"> <i
            class="bi bi-credit-card"></i> Thanh Toán </button>
      </div>
    </div><!-- Cart Page -->
    <div id="cartPage">
      <div class="page-content">
        <div class="items-section">
          <div class="select-all-section"><input type="checkbox" id="selectAll" class="select-all-checkbox"
              onchange="toggleSelectAll()"> <label for="selectAll" class="select-all-label">Chọn tất cả sản phẩm</label>
          </div>
          <div id="cartItems"><!-- Cart items will be rendered here -->
          </div>
        </div>
        <div class="summary-section">
          <div class="summary-title">
            Tóm Tắt Đơn Hàng
          </div>
          <div class="selected-count" id="selectedCount">
            Đã chọn 0 sản phẩm
          </div>
          <div class="summary-row"><span>Tạm tính:</span> <span id="subtotal">0₫</span>
          </div>
          <div class="summary-row"><span>Phí vận chuyển:</span> <span id="shipping">0₫</span>
          </div>
          <div class="summary-row total"><span>Tổng cộng:</span> <span class="amount" id="total">0₫</span>
          </div><button class="checkout-btn" id="proceedCheckout" onclick="proceedToCheckout()" disabled> <i
              class="bi bi-credit-card"></i> Tiến Hành Thanh Toán </button> <button class="continue-shopping"
            onclick="continueShopping()"> <i class="bi bi-arrow-left"></i> Tiếp Tục Mua Sắm </button>
        </div>
      </div>
    </div><!-- Checkout Page -->
    <div id="checkoutPage" style="display: none;">
      <div class="page-content">
        <div>
          <div class="checkout-form">
            <div class="form-section">
              <h3><i class="bi bi-person-fill"></i> Thông Tin Giao Hàng</h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group"><label class="form-label" for="fullName">Họ và tên *</label> <input
                      type="text" id="fullName" class="form-input" placeholder="Nhập họ và tên">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group"><label class="form-label" for="phone">Số điện thoại *</label> <input
                      type="tel" id="phone" class="form-input" placeholder="Nhập số điện thoại">
                  </div>
                </div>
              </div>
              <div class="form-group"><label class="form-label" for="email">Email</label> <input type="email" id="email"
                  class="form-input" placeholder="Nhập email">
              </div>
              <div class="form-group"><label class="form-label" for="address">Địa chỉ giao hàng *</label> <input
                  type="text" id="address" class="form-input" placeholder="Nhập địa chỉ chi tiết">
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group"><label class="form-label" for="city">Tỉnh/Thành phố *</label> <input
                      type="text" id="city" class="form-input" placeholder="Chọn tỉnh/thành">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group"><label class="form-label" for="district">Quận/Huyện *</label> <input
                      type="text" id="district" class="form-input" placeholder="Chọn quận/huyện">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group"><label class="form-label" for="ward">Phường/Xã *</label> <input type="text"
                      id="ward" class="form-input" placeholder="Chọn phường/xã">
                  </div>
                </div>
              </div>
            </div>
            <div class="form-section">
              <h3><i class="bi bi-tag-fill"></i> Mã Giảm Giá</h3>
              <div class="discount-section">
                <div class="discount-input-group"><input type="text" id="discountCode" class="form-input discount-input"
                    placeholder="Nhập mã giảm giá"> <button class="apply-btn" onclick="applyDiscount()">Áp Dụng</button>
                </div>
                <div id="discountMessage" style="margin-top: 10px; font-size: 14px;"></div>
              </div>
            </div>
          </div>
          <div class="checkout-items">
            <h3 style="color: #2d3748; font-weight: 600; margin-bottom: 20px;"><i class="bi bi-bag-check-fill"></i> Sản
              Phẩm Đã Chọn</h3>
            <div id="checkoutItemsList"><!-- Selected items will be rendered here -->
            </div>
          </div>
        </div>
        <div class="summary-section">
          <div class="summary-title">
            Chi Tiết Thanh Toán
          </div>
          <div class="summary-row"><span>Tạm tính:</span> <span id="checkoutSubtotal">0₫</span>
          </div>
          <div class="summary-row"><span>Phí vận chuyển:</span> <span id="checkoutShipping">0₫</span>
          </div>
          <div class="summary-row"><span>Giảm giá:</span> <span id="checkoutDiscount" style="color: #48bb78;">-0₫</span>
          </div>
          <div class="summary-row total"><span>Tổng thanh toán:</span> <span class="amount" id="checkoutTotal">0₫</span>
          </div><button class="checkout-btn" onclick="placeOrder()"> <i class="bi bi-check-circle"></i> Đặt Hàng
          </button> <button class="continue-shopping" onclick="showCart()"> <i class="bi bi-arrow-left"></i> Quay Lại
            Giỏ Hàng </button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const defaultConfig = {
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      background_color: "#ffffff",
      text_color: "#2d3748",
      accent_color: "#48bb78"
    };

    // Sample cart data
    let cartData = [
      {
        id: 1,
        title: "Đắc Nhân Tâm",
        author: "Dale Carnegie",
        price: 86000,
        quantity: 2,
        selected: false,
        image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='160' viewBox='0 0 120 160'%3E%3Crect fill='%23667eea' width='120' height='160'/%3E%3Ctext x='50%25' y='45%25' font-family='Arial' font-size='14' fill='white' text-anchor='middle' dominant-baseline='middle'%3EĐắc Nhân%3C/text%3E%3Ctext x='50%25' y='55%25' font-family='Arial' font-size='14' fill='white' text-anchor='middle' dominant-baseline='middle'%3ETâm%3C/text%3E%3C/svg%3E"
      },
      {
        id: 2,
        title: "Nhà Giả Kim",
        author: "Paulo Coelho",
        price: 79000,
        quantity: 1,
        selected: false,
        image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='160' viewBox='0 0 120 160'%3E%3Crect fill='%23f6ad55' width='120' height='160'/%3E%3Ctext x='50%25' y='45%25' font-family='Arial' font-size='14' fill='white' text-anchor='middle' dominant-baseline='middle'%3ENhà Giả%3C/text%3E%3Ctext x='50%25' y='55%25' font-family='Arial' font-size='14' fill='white' text-anchor='middle' dominant-baseline='middle'%3EKim%3C/text%3E%3C/svg%3E"
      },
      {
        id: 3,
        title: "Sapiens: Lược Sử Loài Người",
        author: "Yuval Noah Harari",
        price: 189000,
        quantity: 1,
        selected: false,
        image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='160' viewBox='0 0 120 160'%3E%3Crect fill='%2348bb78' width='120' height='160'/%3E%3Ctext x='50%25' y='50%25' font-family='Arial' font-size='12' fill='white' text-anchor='middle' dominant-baseline='middle'%3ESapiens%3C/text%3E%3C/svg%3E"
      }
    ];

    let currentPage = 'cart';
    let discountAmount = 0;
    let appliedDiscountCode = '';

    function formatCurrency(amount) {
      return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
      }).format(amount);
    }

    function renderCart() {
      const cartItemsContainer = document.getElementById('cartItems');

      if (cartData.length === 0) {
        cartItemsContainer.innerHTML = `
          <div class="empty-state">
            <i class="bi bi-cart-x"></i>
            <h3>Giỏ hàng trống</h3>
            <p>Hãy thêm sách vào giỏ hàng để tiếp tục mua sắm!</p>
          </div>
        `;
        updateCartSummary();
        return;
      }

      cartItemsContainer.innerHTML = cartData.map(item => `
        <div class="item ${item.selected ? 'selected' : ''}" data-id="${item.id}">
          <input type="checkbox" class="item-checkbox" ${item.selected ? 'checked' : ''} 
                 onchange="toggleItemSelection(${item.id})">
          <img src="${item.image}" alt="${item.title}" class="book-image">
          <div class="item-details">
            <div class="book-info">
              <div class="book-title">${item.title}</div>
              <div class="book-author">Tác giả: ${item.author}</div>
              <div class="book-price">${formatCurrency(item.price)}</div>
            </div>
            <div class="item-actions">
              <div class="quantity-section">
                <span class="quantity-label">Số lượng:</span>
                <div class="quantity-control">
                  <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">
                    <i class="bi bi-dash"></i>
                  </button>
                  <span class="quantity-display">${item.quantity}</span>
                  <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">
                    <i class="bi bi-plus"></i>
                  </button>
                </div>
              </div>
              <div class="item-total">${formatCurrency(item.price * item.quantity)}</div>
              <button class="remove-btn" onclick="removeItem(${item.id})" title="Xóa sản phẩm">
                <i class="bi bi-trash" style="font-size: 20px;"></i>
              </button>
            </div>
          </div>
        </div>
      `).join('');

      updateCartSummary();
      updateSelectAllCheckbox();
    }

    function renderCheckoutItems() {
      const selectedItems = cartData.filter(item => item.selected);
      const checkoutItemsContainer = document.getElementById('checkoutItemsList');

      if (selectedItems.length === 0) {
        checkoutItemsContainer.innerHTML = `
          <div class="empty-state">
            <i class="bi bi-bag-x"></i>
            <h3>Chưa có sản phẩm nào được chọn</h3>
            <p>Vui lòng quay lại giỏ hàng và chọn sản phẩm!</p>
          </div>
        `;
        return;
      }

      checkoutItemsContainer.innerHTML = selectedItems.map(item => `
        <div class="checkout-item">
          <img src="${item.image}" alt="${item.title}" class="checkout-item-image">
          <div class="checkout-item-details">
            <div class="checkout-item-title">${item.title}</div>
            <div class="checkout-item-author">Tác giả: ${item.author}</div>
            <div class="checkout-item-quantity">Số lượng: ${item.quantity}</div>
          </div>
          <div class="checkout-item-price">${formatCurrency(item.price * item.quantity)}</div>
        </div>
      `).join('');

      updateCheckoutSummary();
    }

    function toggleItemSelection(itemId) {
      const item = cartData.find(i => i.id === itemId);
      if (item) {
        item.selected = !item.selected;
        renderCart();
      }
    }

    function toggleSelectAll() {
      const selectAllCheckbox = document.getElementById('selectAll');
      const allSelected = selectAllCheckbox.checked;

      cartData.forEach(item => {
        item.selected = allSelected;
      });

      renderCart();
    }

    function updateSelectAllCheckbox() {
      const selectAllCheckbox = document.getElementById('selectAll');
      const selectedCount = cartData.filter(item => item.selected).length;
      const totalCount = cartData.length;

      selectAllCheckbox.checked = selectedCount === totalCount && totalCount > 0;
      selectAllCheckbox.indeterminate = selectedCount > 0 && selectedCount < totalCount;
    }

    function updateQuantity(itemId, change) {
      const item = cartData.find(i => i.id === itemId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeItem(itemId);
        } else {
          renderCart();
        }
      }
    }

    function removeItem(itemId) {
      cartData = cartData.filter(item => item.id !== itemId);
      renderCart();
    }

    function updateCartSummary() {
      const selectedItems = cartData.filter(item => item.selected);
      const selectedCount = selectedItems.length;
      const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const shipping = selectedCount > 0 ? 30000 : 0;
      const total = subtotal + shipping;

      document.getElementById('selectedCount').textContent = `Đã chọn ${selectedCount} sản phẩm`;
      document.getElementById('subtotal').textContent = formatCurrency(subtotal);
      document.getElementById('shipping').textContent = formatCurrency(shipping);
      document.getElementById('total').textContent = formatCurrency(total);

      const checkoutBtn = document.getElementById('proceedCheckout');
      checkoutBtn.disabled = selectedCount === 0;
    }

    function updateCheckoutSummary() {
      const selectedItems = cartData.filter(item => item.selected);
      const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const shipping = selectedItems.length > 0 ? 30000 : 0;
      const total = subtotal + shipping - discountAmount;

      document.getElementById('checkoutSubtotal').textContent = formatCurrency(subtotal);
      document.getElementById('checkoutShipping').textContent = formatCurrency(shipping);
      document.getElementById('checkoutDiscount').textContent = `-${formatCurrency(discountAmount)}`;
      document.getElementById('checkoutTotal').textContent = formatCurrency(total);
    }

    function showCart() {
      currentPage = 'cart';
      document.getElementById('cartPage').style.display = 'block';
      document.getElementById('checkoutPage').style.display = 'none';
      document.getElementById('pageTitle').innerHTML = '<i class="bi bi-cart-fill"></i> Giỏ Hàng Của Bạn';

      document.getElementById('cartBtn').classList.add('active');
      document.getElementById('checkoutBtn').classList.remove('active');

      renderCart();
    }

    function showCheckout() {
      const selectedItems = cartData.filter(item => item.selected);
      if (selectedItems.length === 0) {
        showMessage('Vui lòng chọn ít nhất một sản phẩm để thanh toán!');
        return;
      }

      currentPage = 'checkout';
      document.getElementById('cartPage').style.display = 'none';
      document.getElementById('checkoutPage').style.display = 'block';
      document.getElementById('pageTitle').innerHTML = '<i class="bi bi-credit-card-fill"></i> Thanh Toán';

      document.getElementById('cartBtn').classList.remove('active');
      document.getElementById('checkoutBtn').classList.add('active');

      renderCheckoutItems();
    }

    function proceedToCheckout() {
      showCheckout();
    }

    function applyDiscount() {
      const discountCode = document.getElementById('discountCode').value.trim().toUpperCase();
      const messageElement = document.getElementById('discountMessage');

      if (!discountCode) {
        messageElement.innerHTML = '<span style="color: #e53e3e;">Vui lòng nhập mã giảm giá!</span>';
        return;
      }

      // Sample discount codes
      const discountCodes = {
        'BOOK10': { percent: 10, description: 'Giảm 10%' },
        'NEWUSER': { percent: 15, description: 'Giảm 15% cho khách hàng mới' },
        'SALE20': { percent: 20, description: 'Giảm 20%' }
      };

      if (discountCodes[discountCode]) {
        const selectedItems = cartData.filter(item => item.selected);
        const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

        discountAmount = Math.floor(subtotal * discountCodes[discountCode].percent / 100);
        appliedDiscountCode = discountCode;

        messageElement.innerHTML = `<span style="color: #48bb78;"><i class="bi bi-check-circle"></i> Áp dụng thành công! ${discountCodes[discountCode].description}</span>`;
        updateCheckoutSummary();
      } else {
        messageElement.innerHTML = '<span style="color: #e53e3e;"><i class="bi bi-x-circle"></i> Mã giảm giá không hợp lệ!</span>';
      }
    }

    function placeOrder() {
      const selectedItems = cartData.filter(item => item.selected);
      if (selectedItems.length === 0) {
        showMessage('Không có sản phẩm nào được chọn!');
        return;
      }

      // Validate required fields
      const requiredFields = ['fullName', 'phone', 'address', 'city', 'district', 'ward'];
      const missingFields = [];

      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
          missingFields.push(field.previousElementSibling.textContent.replace(' *', ''));
        }
      });

      if (missingFields.length > 0) {
        showMessage(`Vui lòng điền đầy đủ thông tin: ${missingFields.join(', ')}`);
        return;
      }

      showMessage('Đặt hàng thành công! Cảm ơn bạn đã mua sắm tại cửa hàng.');

      // Remove selected items from cart
      cartData = cartData.filter(item => !item.selected);
      discountAmount = 0;
      appliedDiscountCode = '';
      document.getElementById('discountCode').value = '';
      document.getElementById('discountMessage').innerHTML = '';

      // Clear form
      requiredFields.forEach(fieldId => {
        document.getElementById(fieldId).value = '';
      });
      document.getElementById('email').value = '';

      showCart();
    }

    function continueShopping() {
      showMessage('Chuyển đến trang danh sách sách...');
    }

    function showMessage(message) {
      const messageDiv = document.createElement('div');
      messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        animation: slideIn 0.3s ease;
        border-left: 4px solid #667eea;
        max-width: 400px;
      `;
      messageDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
          <i class="bi bi-info-circle-fill" style="color: #667eea; font-size: 24px;"></i>
          <span style="color: #2d3748; font-weight: 500;">${message}</span>
        </div>
      `;
      document.body.appendChild(messageDiv);
      setTimeout(() => {
        messageDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => messageDiv.remove(), 300);
      }, 4000);
    }

    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(400px); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    async function onConfigChange(config) {
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      document.body.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;

      const items = document.querySelectorAll('.item, .checkout-item');
      items.forEach(item => {
        item.style.background = backgroundColor;
      });

      const quantityBtns = document.querySelectorAll('.quantity-btn');
      quantityBtns.forEach(btn => {
        btn.style.background = primaryColor;
      });

      const checkoutBtns = document.querySelectorAll('.checkout-btn');
      checkoutBtns.forEach(btn => {
        btn.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      });

      const applyBtns = document.querySelectorAll('.apply-btn');
      applyBtns.forEach(btn => {
        btn.style.background = primaryColor;
      });

      const selectedCounts = document.querySelectorAll('.selected-count');
      selectedCounts.forEach(count => {
        count.style.background = primaryColor;
      });

      const itemPrices = document.querySelectorAll('.book-price, .item-total, .checkout-item-price');
      itemPrices.forEach(price => {
        price.style.color = primaryColor;
      });

      const totalAmounts = document.querySelectorAll('.summary-row.total .amount');
      totalAmounts.forEach(amount => {
        amount.style.color = primaryColor;
      });

      const bookTitles = document.querySelectorAll('.book-title, .checkout-item-title');
      bookTitles.forEach(title => {
        title.style.color = textColor;
      });

      const discountElements = document.querySelectorAll('#checkoutDiscount');
      discountElements.forEach(discount => {
        discount.style.color = accentColor;
      });

      const navBtns = document.querySelectorAll('.nav-btn');
      navBtns.forEach(btn => {
        btn.style.borderColor = primaryColor;
        btn.style.color = primaryColor;
      });

      const activeNavBtns = document.querySelectorAll('.nav-btn.active');
      activeNavBtns.forEach(btn => {
        btn.style.background = primaryColor;
        btn.style.color = 'white';
      });

      const pageIcons = document.querySelectorAll('.page-header h1 i');
      pageIcons.forEach(icon => {
        icon.style.color = primaryColor;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map()
      });
    }

    // Initialize cart on page load
    document.addEventListener('DOMContentLoaded', () => {
      renderCart();
    });
  </script>
  <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'99aefa4c271f5e40',t:'MTc2MjU0MTAyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>